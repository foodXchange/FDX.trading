@page "/portal/buyer/rfq/create"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "SuperAdmin,Admin,Buyer")]
@rendermode InteractiveServer

<PageTitle>Create RFQ - FoodX Buyer Portal</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudGrid>
        <MudItem xs="12">
            <MudText Typo="Typo.h4" GutterBottom="true">
                <MudIcon Icon="@Icons.Material.Filled.Add" Class="mr-2" />
                Create New RFQ
            </MudText>
        </MudItem>

        <MudItem xs="12" md="8">
            <MudPaper Class="pa-4" Elevation="2">
                <MudForm @ref="_form" Model="@_rfqModel">
                    <MudGrid>
                        <MudItem xs="12">
                            <MudText Typo="Typo.h6" Class="mb-4">RFQ Details</MudText>
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_rfqModel.Title" 
                                        Label="RFQ Title" 
                                        Required="true" 
                                        For="@(() => _rfqModel.Title)" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudSelect @bind-Value="_rfqModel.Category" 
                                     Label="Product Category" 
                                     Required="true">
                                <MudSelectItem Value="@("Produce")">Fresh Produce</MudSelectItem>
                                <MudSelectItem Value="@("Dairy")">Dairy Products</MudSelectItem>
                                <MudSelectItem Value="@("Meat")">Meat & Poultry</MudSelectItem>
                                <MudSelectItem Value="@("Seafood")">Seafood</MudSelectItem>
                                <MudSelectItem Value="@("Bakery")">Bakery</MudSelectItem>
                                <MudSelectItem Value="@("Pantry")">Pantry Items</MudSelectItem>
                            </MudSelect>
                        </MudItem>

                        <MudItem xs="12">
                            <MudTextField @bind-Value="_rfqModel.Description" 
                                        Label="Product Description" 
                                        Lines="4" 
                                        Required="true"
                                        For="@(() => _rfqModel.Description)" />
                        </MudItem>

                        <MudItem xs="12" md="4">
                            <MudTextField @bind-Value="_rfqModel.Quantity" 
                                        Label="Quantity" 
                                        Required="true"
                                        For="@(() => _rfqModel.Quantity)" />
                        </MudItem>

                        <MudItem xs="12" md="4">
                            <MudSelect @bind-Value="_rfqModel.Unit" 
                                     Label="Unit" 
                                     Required="true">
                                <MudSelectItem Value="@("kg")">Kilograms</MudSelectItem>
                                <MudSelectItem Value="@("lbs")">Pounds</MudSelectItem>
                                <MudSelectItem Value="@("pieces")">Pieces</MudSelectItem>
                                <MudSelectItem Value="@("boxes")">Boxes</MudSelectItem>
                                <MudSelectItem Value="@("liters")">Liters</MudSelectItem>
                                <MudSelectItem Value="@("gallons")">Gallons</MudSelectItem>
                            </MudSelect>
                        </MudItem>

                        <MudItem xs="12" md="4">
                            <MudDatePicker @bind-Date="_rfqModel.DeadlineDate" 
                                         Label="Response Deadline" 
                                         Required="true" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudDatePicker @bind-Date="_rfqModel.DeliveryDate" 
                                         Label="Required Delivery Date" 
                                         Required="true" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_rfqModel.DeliveryLocation" 
                                        Label="Delivery Location" 
                                        Required="true"
                                        For="@(() => _rfqModel.DeliveryLocation)" />
                        </MudItem>

                        <MudItem xs="12">
                            <MudTextField @bind-Value="_rfqModel.SpecialRequirements" 
                                        Label="Special Requirements" 
                                        Lines="3" 
                                        Placeholder="Any special requirements, certifications, or quality standards..."
                                        For="@(() => _rfqModel.SpecialRequirements)" />
                        </MudItem>

                        <MudItem xs="12">
                            <MudText Typo="Typo.h6" Class="mb-2">Supplier Selection</MudText>
                            <MudCheckBox T="bool" @bind-Checked="_rfqModel.SendToAllSuppliers" 
                                       Label="Send to all approved suppliers" />
                            <MudCheckBox T="bool" @bind-Checked="_rfqModel.SendToSpecificSuppliers" 
                                       Label="Send to specific suppliers only" />
                        </MudItem>

                        <MudItem xs="12" Class="d-flex justify-end gap-4 mt-4">
                            <MudButton Variant="Variant.Text" 
                                     Color="Color.Secondary"
                                     Href="/portal/buyer/rfqs">
                                Cancel
                            </MudButton>
                            <MudButton Variant="Variant.Text" 
                                     Color="Color.Primary"
                                     OnClick="SaveDraft">
                                Save as Draft
                            </MudButton>
                            <MudButton Variant="Variant.Filled" 
                                     Color="Color.Primary"
                                     OnClick="PublishRFQ">
                                Publish RFQ
                            </MudButton>
                        </MudItem>
                    </MudGrid>
                </MudForm>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="4">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">RFQ Guidelines</MudText>
                <MudList T="string">
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Info" Text="Provide clear and detailed product descriptions" />
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Info" Text="Specify exact quantities and units" />
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Info" Text="Set realistic response deadlines" />
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Info" Text="Include quality standards and certifications" />
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Info" Text="Mention preferred delivery locations" />
                </MudList>

                <MudDivider Class="my-4" />

                <MudText Typo="Typo.subtitle2" Class="mb-2">Quick Stats</MudText>
                <MudText Typo="Typo.body2" Class="mb-1">Active Suppliers: 45</MudText>
                <MudText Typo="Typo.body2" Class="mb-1">Avg Response Time: 2.5 days</MudText>
                <MudText Typo="Typo.body2">Success Rate: 87%</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private MudForm _form = new();
    private CreateRFQModel _rfqModel = new();
    
    protected override void OnInitialized()
    {
        _rfqModel = new CreateRFQModel
        {
            DeadlineDate = DateTime.Now.AddDays(7),
            DeliveryDate = DateTime.Now.AddDays(14),
            Unit = "kg",
            Category = "Produce"
        };
    }
    
    private async Task SaveDraft()
    {
        // Implementation for saving draft
        await Task.CompletedTask;
        // Show success message
    }
    
    private async Task PublishRFQ()
    {
        await _form.Validate();
        if (_form.IsValid)
        {
            // Implementation for publishing RFQ
            await Task.CompletedTask;
            // Redirect to RFQs list
        }
    }
    
    private class CreateRFQModel
    {
        public string Title { get; set; } = "";
        public string Category { get; set; } = "";
        public string Description { get; set; } = "";
        public string Quantity { get; set; } = "";
        public string Unit { get; set; } = "";
        public DateTime? DeadlineDate { get; set; }
        public DateTime? DeliveryDate { get; set; }
        public string DeliveryLocation { get; set; } = "";
        public string SpecialRequirements { get; set; } = "";
        public bool SendToAllSuppliers { get; set; } = true;
        public bool SendToSpecificSuppliers { get; set; } = false;
    }
}