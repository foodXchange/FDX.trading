@page "/help"
@using Microsoft.AspNetCore.Authorization
@inject ISnackbar Snackbar
@inject NavigationManager Navigation
@attribute [Authorize]
@rendermode InteractiveServer

<PageTitle>Help & Support - FoodX</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudGrid>
        <MudItem xs="12">
            <MudText Typo="Typo.h3" GutterBottom="true">
                <MudIcon Icon="@Icons.Material.Filled.Help" Class="mr-2" />
                Help & Support
            </MudText>
        </MudItem>

        <!-- Quick Help Section -->
        <MudItem xs="12" md="8">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">Frequently Asked Questions</MudText>
                
                <MudExpansionPanels>
                    <MudExpansionPanel Text="How do I create an RFQ?">
                        <MudText>
                            Navigate to Procurement → RFQs and click the "Create New RFQ" button. Fill in the required fields and submit.
                        </MudText>
                    </MudExpansionPanel>
                    
                    <MudExpansionPanel Text="How do I manage my products?">
                        <MudText>
                            Go to Supply → Products to view, add, or edit your product catalog. You can also import products in bulk.
                        </MudText>
                    </MudExpansionPanel>
                    
                    <MudExpansionPanel Text="How do I search for suppliers?">
                        <MudText>
                            Use the Browse → Suppliers menu or try our AI Search feature for intelligent supplier matching.
                        </MudText>
                    </MudExpansionPanel>
                    
                    <MudExpansionPanel Text="How do I change my account settings?">
                        <MudText>
                            Click on your account icon in the top right and select "Manage Account" to update your profile.
                        </MudText>
                    </MudExpansionPanel>
                </MudExpansionPanels>
            </MudPaper>

            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">Video Tutorials</MudText>
                
                <MudGrid>
                    <MudItem xs="12" sm="6">
                        <MudCard Class="cursor-pointer" @onclick="@(() => PlayVideo("GettingStarted"))">
                            <MudCardContent Class="text-center">
                                <MudIcon Icon="@Icons.Material.Filled.PlayCircle" Size="Size.Large" Color="Color.Primary" />
                                <MudText Typo="Typo.h6">Getting Started</MudText>
                                <MudText Typo="Typo.body2">Learn the basics of FoodX platform</MudText>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                    
                    <MudItem xs="12" sm="6">
                        <MudCard Class="cursor-pointer" @onclick="@(() => PlayVideo("AdvancedFeatures"))">
                            <MudCardContent Class="text-center">
                                <MudIcon Icon="@Icons.Material.Filled.PlayCircle" Size="Size.Large" Color="Color.Primary" />
                                <MudText Typo="Typo.h6">Advanced Features</MudText>
                                <MudText Typo="Typo.body2">Master advanced platform features</MudText>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </MudItem>

        <!-- Contact Support Section -->
        <MudItem xs="12" md="4">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">Contact Support</MudText>
                
                <MudList T="string">
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Email">
                        <MudText>support@fdx.trading</MudText>
                    </MudListItem>
                    
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Phone">
                        <MudText>+972-3-123-4567</MudText>
                    </MudListItem>
                    
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Schedule">
                        <MudText>Sun-Thu: 9:00-18:00 IST</MudText>
                    </MudListItem>
                </MudList>
                
                <MudDivider Class="my-3" />
                
                <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                           StartIcon="@Icons.Material.Filled.Chat"
                           OnClick="StartLiveChat">
                    Start Live Chat
                </MudButton>
                
                <MudButton Variant="Variant.Outlined" Color="Color.Secondary" FullWidth="true" 
                           Class="mt-2" StartIcon="@Icons.Material.Filled.BugReport"
                           OnClick="ReportIssue">
                    Report an Issue
                </MudButton>
            </MudPaper>

            <MudPaper Class="pa-4 mt-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-4">Resources</MudText>
                
                <MudList T="string">
                    <MudListItem T="string" Icon="@Icons.Material.Filled.MenuBook" 
                                 OnClick="@(() => OpenResource("UserGuide"))">
                        User Guide
                    </MudListItem>
                    
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Api"
                                 OnClick="@(() => OpenResource("API"))">
                        API Documentation
                    </MudListItem>
                    
                    <MudListItem T="string" Icon="@Icons.Material.Filled.School"
                                 OnClick="@(() => OpenResource("Training"))">
                        Training Center
                    </MudListItem>
                    
                    <MudListItem T="string" Icon="@Icons.Material.Filled.Update"
                                 OnClick="@(() => OpenResource("ReleaseNotes"))">
                        Release Notes
                    </MudListItem>
                </MudList>
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    protected override void OnInitialized()
    {
        try
        {
            base.OnInitialized();
        }
        catch (Exception ex)
        {
            // Log error but don't display to user
            Console.WriteLine($"Error initializing Help page: {ex.Message}");
        }
    }
    
    protected override async Task OnInitializedAsync()
    {
        try
        {
            await base.OnInitializedAsync();
        }
        catch (Exception ex)
        {
            // Log error but don't display to user
            Console.WriteLine($"Error in Help page initialization: {ex.Message}");
        }
    }
    
    private void StartLiveChat()
    {
        // Open live chat window or navigate to chat page
        Snackbar.Add("Opening live chat support...", Severity.Info);
        // In a real implementation, this would open a chat widget or navigate to a chat page
    }
    
    private void ReportIssue()
    {
        // Navigate to issue reporting form or open modal
        Snackbar.Add("Opening issue report form...", Severity.Info);
        Navigation.NavigateTo("/support/report-issue");
    }
    
    private void OpenResource(string resourceType)
    {
        var message = resourceType switch
        {
            "UserGuide" => "Opening User Guide...",
            "API" => "Opening API Documentation...",
            "Training" => "Opening Training Center...",
            "ReleaseNotes" => "Opening Release Notes...",
            _ => "Opening resource..."
        };
        
        Snackbar.Add(message, Severity.Info);
        
        // In a real implementation, these would open the actual resources
        // For now, we'll just show a notification
    }
    
    private void PlayVideo(string videoType)
    {
        var message = videoType switch
        {
            "GettingStarted" => "Playing Getting Started video...",
            "AdvancedFeatures" => "Playing Advanced Features video...",
            _ => "Playing video..."
        };
        
        Snackbar.Add(message, Severity.Info);
        
        // In a real implementation, this would open a video player modal or navigate to video page
    }
}