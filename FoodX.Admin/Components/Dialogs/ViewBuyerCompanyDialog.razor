@using FoodX.Admin.Models
@using MudBlazor
@inject ISnackbar Snackbar

<MudDialog>
    <DialogContent>
        @if (Company != null)
        {
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.h6">Company Information</MudText>
                    <MudSimpleTable Hover="true" Dense="true" Class="mt-2">
                        <tbody>
                            <tr>
                                <td><strong>Company Name:</strong></td>
                                <td>@Company.Company</td>
                            </tr>
                            <tr>
                                <td><strong>Type:</strong></td>
                                <td>@Company.Type</td>
                            </tr>
                            <tr>
                                <td><strong>Size:</strong></td>
                                <td>@(Company.Size ?? "Not specified")</td>
                            </tr>
                            <tr>
                                <td><strong>Region:</strong></td>
                                <td>@Company.Region</td>
                            </tr>
                            <tr>
                                <td><strong>Markets:</strong></td>
                                <td>@Company.Markets</td>
                            </tr>
                            <tr>
                                <td><strong>Categories:</strong></td>
                                <td>@Company.Categories</td>
                            </tr>
                            @if (!string.IsNullOrEmpty(Company.Website))
                            {
                                <tr>
                                    <td><strong>Website:</strong></td>
                                    <td>
                                        <MudLink Href="@Company.Website" Target="_blank">
                                            @Company.Website
                                        </MudLink>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </MudSimpleTable>
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.h6">Contact Information</MudText>
                    <MudSimpleTable Hover="true" Dense="true" Class="mt-2">
                        <tbody>
                            @if (!string.IsNullOrEmpty(Company.KeyContact))
                            {
                                <tr>
                                    <td><strong>Key Contact:</strong></td>
                                    <td>@Company.KeyContact</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.Title))
                            {
                                <tr>
                                    <td><strong>Title:</strong></td>
                                    <td>@Company.Title</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.ProcurementContact))
                            {
                                <tr>
                                    <td><strong>Procurement Contact:</strong></td>
                                    <td>@Company.ProcurementContact</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.ProcurementEmail))
                            {
                                <tr>
                                    <td><strong>Procurement Email:</strong></td>
                                    <td>
                                        <MudLink Href="@($"mailto:{Company.ProcurementEmail}")">
                                            @Company.ProcurementEmail
                                        </MudLink>
                                    </td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.ContactEmail))
                            {
                                <tr>
                                    <td><strong>Contact Email:</strong></td>
                                    <td>
                                        <MudLink Href="@($"mailto:{Company.ContactEmail}")">
                                            @Company.ContactEmail
                                        </MudLink>
                                    </td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.Phone))
                            {
                                <tr>
                                    <td><strong>Phone:</strong></td>
                                    <td>@Company.Phone</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.Mobile))
                            {
                                <tr>
                                    <td><strong>Mobile:</strong></td>
                                    <td>@Company.Mobile</td>
                                </tr>
                            }
                        </tbody>
                    </MudSimpleTable>
                </MudItem>

                @* AI Intelligence Section *@
                @if (Company.EngagementReadinessScore.HasValue || Company.PurchasingPowerScore.HasValue || Company.DataCompletenessScore.HasValue)
                {
                    <MudItem xs="12">
                        <MudText Typo="Typo.h6" Class="mt-3">AI Intelligence Metrics</MudText>
                        <MudGrid Class="mt-2">
                            @if (Company.EngagementReadinessScore.HasValue)
                            {
                                <MudItem xs="12" sm="4">
                                    <MudCard>
                                        <MudCardContent Class="pa-2">
                                            <MudText Typo="Typo.caption">Engagement Readiness</MudText>
                                            <MudProgressLinear Color="@GetScoreColor(Company.EngagementReadinessScore.Value)" 
                                                             Value="Company.EngagementReadinessScore.Value" 
                                                             Max="100" 
                                                             Class="my-2" />
                                            <MudText Typo="Typo.h6" Align="Align.Center">@Company.EngagementReadinessScore%</MudText>
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            }
                            @if (Company.PurchasingPowerScore.HasValue)
                            {
                                <MudItem xs="12" sm="4">
                                    <MudCard>
                                        <MudCardContent Class="pa-2">
                                            <MudText Typo="Typo.caption">Purchasing Power</MudText>
                                            <MudProgressLinear Color="@GetScoreColor(Company.PurchasingPowerScore.Value)" 
                                                             Value="Company.PurchasingPowerScore.Value" 
                                                             Max="100" 
                                                             Class="my-2" />
                                            <MudText Typo="Typo.h6" Align="Align.Center">@Company.PurchasingPowerScore%</MudText>
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            }
                            @if (Company.DataCompletenessScore.HasValue)
                            {
                                <MudItem xs="12" sm="4">
                                    <MudCard>
                                        <MudCardContent Class="pa-2">
                                            <MudText Typo="Typo.caption">Data Completeness</MudText>
                                            <MudProgressLinear Color="@GetScoreColor((int)Company.DataCompletenessScore.Value)" 
                                                             Value="(int)Company.DataCompletenessScore.Value" 
                                                             Max="100" 
                                                             Class="my-2" />
                                            <MudText Typo="Typo.h6" Align="Align.Center">@((int)Company.DataCompletenessScore.Value)%</MudText>
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            }
                        </MudGrid>
                        
                        @if (Company.AiReady == true)
                        {
                            <MudAlert Severity="Severity.Success" Dense="true" Class="mt-2">
                                <MudText Typo="Typo.body2">âœ… AI-Ready Buyer - Optimized for automated engagement</MudText>
                            </MudAlert>
                        }
                    </MudItem>
                }

                @* Business Intelligence Section *@
                @if (!string.IsNullOrEmpty(Company.FoodFocus) || Company.EmployeeCount.HasValue || Company.StoreCount.HasValue || !string.IsNullOrEmpty(Company.AnnualRevenue))
                {
                    <MudItem xs="12">
                        <MudText Typo="Typo.h6" Class="mt-3">Business Intelligence</MudText>
                        <MudSimpleTable Hover="true" Dense="true" Class="mt-2">
                            <tbody>
                                @if (!string.IsNullOrEmpty(Company.FoodFocus))
                                {
                                    <tr>
                                        <td><strong>Food Focus:</strong></td>
                                        <td>@Company.FoodFocus</td>
                                    </tr>
                                }
                                @if (Company.FoundedYear.HasValue)
                                {
                                    <tr>
                                        <td><strong>Founded:</strong></td>
                                        <td>@Company.FoundedYear (Operating for @(DateTime.Now.Year - Company.FoundedYear.Value) years)</td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Company.AnnualRevenue))
                                {
                                    <tr>
                                        <td><strong>Annual Revenue:</strong></td>
                                        <td>@Company.AnnualRevenue</td>
                                    </tr>
                                }
                                @if (Company.EmployeeCount.HasValue)
                                {
                                    <tr>
                                        <td><strong>Employees:</strong></td>
                                        <td>@Company.EmployeeCount.Value.ToString("N0")</td>
                                    </tr>
                                }
                                @if (Company.StoreCount.HasValue)
                                {
                                    <tr>
                                        <td><strong>Store Locations:</strong></td>
                                        <td>@Company.StoreCount.Value.ToString("N0")</td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Company.MinimumOrderValue))
                                {
                                    <tr>
                                        <td><strong>Minimum Order:</strong></td>
                                        <td>@Company.MinimumOrderValue</td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Company.PaymentTerms))
                                {
                                    <tr>
                                        <td><strong>Payment Terms:</strong></td>
                                        <td>@Company.PaymentTerms</td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Company.CertificationsRequired))
                                {
                                    <tr>
                                        <td><strong>Required Certifications:</strong></td>
                                        <td>@Company.CertificationsRequired</td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(Company.VerificationStatus))
                                {
                                    <tr>
                                        <td><strong>Verification:</strong></td>
                                        <td>
                                            <MudChip T="string" Color="@(Company.VerificationStatus == "Verified" ? Color.Success : Color.Default)" Size="Size.Small">
                                                @Company.VerificationStatus
                                            </MudChip>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </MudSimpleTable>
                    </MudItem>
                }

                <MudItem xs="12">
                    <MudText Typo="Typo.h6" Class="mt-3">Additional Details</MudText>
                    <MudSimpleTable Hover="true" Dense="true" Class="mt-2">
                        <tbody>
                            @if (!string.IsNullOrEmpty(Company.Address))
                            {
                                <tr>
                                    <td><strong>Address:</strong></td>
                                    <td>@Company.Address</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.DistributionCenter))
                            {
                                <tr>
                                    <td><strong>Distribution Center:</strong></td>
                                    <td>@Company.DistributionCenter</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.Stores))
                            {
                                <tr>
                                    <td><strong>Stores:</strong></td>
                                    <td>@Company.Stores</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.MainCategory))
                            {
                                <tr>
                                    <td><strong>Main Category:</strong></td>
                                    <td>@Company.MainCategory</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.SubCategories))
                            {
                                <tr>
                                    <td><strong>Sub Categories:</strong></td>
                                    <td>@Company.SubCategories</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.TargetMarket))
                            {
                                <tr>
                                    <td><strong>Target Market:</strong></td>
                                    <td>@Company.TargetMarket</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.ImportCountries))
                            {
                                <tr>
                                    <td><strong>Import Countries:</strong></td>
                                    <td>@Company.ImportCountries</td>
                                </tr>
                            }
                            @if (Company.AnnualVolume.HasValue)
                            {
                                <tr>
                                    <td><strong>Annual Volume:</strong></td>
                                    <td>@Company.AnnualVolume.Value.ToString("N0")</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.PreferredSuppliers))
                            {
                                <tr>
                                    <td><strong>Preferred Suppliers:</strong></td>
                                    <td>@Company.PreferredSuppliers</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.AccountManager))
                            {
                                <tr>
                                    <td><strong>Account Manager:</strong></td>
                                    <td>@Company.AccountManager</td>
                                </tr>
                            }
                            @if (Company.LastContact.HasValue)
                            {
                                <tr>
                                    <td><strong>Last Contact:</strong></td>
                                    <td>@Company.LastContact.Value.ToString("MMM dd, yyyy")</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.Status))
                            {
                                <tr>
                                    <td><strong>Status:</strong></td>
                                    <td>@Company.Status</td>
                                </tr>
                            }
                            @if (!string.IsNullOrEmpty(Company.Notes))
                            {
                                <tr>
                                    <td><strong>Notes:</strong></td>
                                    <td>@Company.Notes</td>
                                </tr>
                            }
                        </tbody>
                    </MudSimpleTable>
                </MudItem>
            </MudGrid>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Close</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="CopyEmails" StartIcon="@Icons.Material.Filled.ContentCopy">
            Copy Emails
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] 
    IMudDialogInstance MudDialog { get; set; } = null!;
    
    [Parameter] 
    public FoodXBuyer? Company { get; set; }

    private void Cancel()
    {
        MudDialog?.Cancel();
    }

    private Color GetScoreColor(int score)
    {
        return score switch
        {
            >= 80 => Color.Success,
            >= 60 => Color.Info,
            >= 40 => Color.Warning,
            _ => Color.Error
        };
    }

    private async Task CopyEmails()
    {
        var emails = new[] { Company?.ProcurementEmail, Company?.ContactEmail }
            .Where(email => !string.IsNullOrEmpty(email))
            .ToList();
            
        if (emails.Any())
        {
            var emailString = string.Join("; ", emails);
            await Task.CompletedTask; // Placeholder for clipboard functionality
            Snackbar.Add($"Emails copied: {emailString}", Severity.Success);
        }
        else
        {
            Snackbar.Add("No email addresses available to copy", Severity.Warning);
        }
    }
}